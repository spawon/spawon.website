<template>
  <header>
    <div v-if="burgerOpen" class="mobile-menu__bg"></div>
    <div
      v-if="mobile"
      ref="menu"
      class="mobile-menu"
      :class="{ showMenu: burgerOpen }"
    >
      <div class="mobile-menu__wrapper">
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus
        aliquid assumenda at consequuntur corporis cum cupiditate deleniti
        dolore, doloribus eaque, earum enim error esse et explicabo hic impedit
        incidunt ipsam iste iure labore molestias necessitatibus neque numquam
        perferendis quibusdam sed sunt tempora ullam unde vero vitae voluptatem
        voluptatibus. Dolorem expedita fugit in, incidunt laudantium nam neque
        nostrum porro quae quam quidem voluptas? A accusamus animi cumque
        deleniti distinctio dolores dolorum, esse eum eveniet exercitationem hic
        id ipsa laborum natus necessitatibus omnis praesentium quo ratione
        reprehenderit tempora. Aliquid animi atque, dolorem ducimus explicabo
        nobis odio officiis optio quaerat sed? Corporis dolorem eveniet
        inventore iste quam quos rem rerum sequi, similique sit ullam veniam. Ab
        accusamus aliquid amet aut beatae consequatur corporis, dicta doloremque
        doloribus earum, eligendi error fuga id, in incidunt inventore ipsum
        labore minus mollitia nobis nulla officia omnis porro quasi quisquam
        repudiandae temporibus veritatis voluptatem voluptatibus voluptatum.
        Aperiam debitis deserunt ex exercitationem facere illum itaque, magni
        quo. Aliquam atque autem, dolorem eligendi fuga fugit, labore minima
        natus nobis non nostrum odio perspiciatis sunt. Autem beatae eligendi
        facere minima nam numquam, suscipit temporibus totam. Accusantium atque,
        consectetur culpa delectus deleniti ducimus eius ex expedita facere
        facilis fugiat harum impedit iure maiores molestiae nam necessitatibus
        nemo nesciunt perferendis praesentium quibusdam rem repellat repellendus
        rerum soluta temporibus unde! Aperiam, consequatur et illum ipsa
        laboriosam modi nesciunt nisi ullam voluptatem voluptatibus? Ad eum
        facere, ipsam nemo praesentium velit! Architecto, ducimus earum
        excepturi itaque laborum minima modi nulla omnis quia ratione
        reprehenderit similique sint tenetur! A beatae debitis delectus dolore
        excepturi facere illum, inventore maiores modi nihil numquam obcaecati
        quos reiciendis rem vitae voluptas voluptatum. Distinctio dolores eos
        illo itaque libero nihil non omnis quae! Adipisci at facere labore nobis
        porro reiciendis, tenetur? Blanditiis cupiditate laudantium maiores
        nobis numquam quos sequi. Excepturi id itaque natus non officia quasi
        quidem sapiente soluta totam voluptatibus? Ad amet deleniti doloribus
        earum error exercitationem ipsa iste itaque, laboriosam libero magni
        necessitatibus nobis numquam pariatur quam, quibusdam quis ratione
        reprehenderit saepe sequi sint tempora vero? Ab accusamus alias amet
        assumenda atque, commodi consequatur deserunt eos facere fugiat id, iure
        laudantium mollitia quisquam saepe, sequi sint sit velit? Ab accusamus
        at beatae distinctio, ea est eum illum ipsam libero magnam molestiae
        nisi numquam obcaecati perspiciatis placeat quasi quis ratione
        reiciendis reprehenderit rerum sed ut veritatis vero! Aliquam,
        asperiores culpa delectus esse neque nobis non omnis quaerat veniam
        vero? Accusamus architecto assumenda delectus deserunt dicta dolor
        illum, in incidunt inventore, itaque mollitia nemo perspiciatis quis
        saepe soluta tempore ut! Ad aliquid asperiores aut cum delectus dicta
        dolor doloribus eaque earum eligendi error fugit harum in iste, iure
        iusto molestias, nesciunt nihil, odio quae quam quas quia quis
        recusandae sequi soluta tempore ullam vitae voluptas voluptatem. A
        dignissimos distinctio harum itaque labore molestiae nostrum quae
        tempore. A earum, est eum excepturi id itaque magnam magni nobis numquam
        perferendis possimus ratione repellat totam, veritatis, vitae? A,
        commodi cumque delectus deleniti deserunt, eaque enim et eum eveniet ex
        fugit harum id ipsa iste itaque magnam minima minus molestias nam natus
        nobis nulla optio porro quae quaerat qui quibusdam ratione recusandae
        repellat repellendus sapiente sunt, tempore totam ut vero voluptate
        voluptatem? Aut doloremque nesciunt quidem rem rerum, similique totam.
        Debitis dolor eos, fugit harum illo inventore ipsa ipsam magnam
        perferendis quidem quos sint sit. Ab asperiores, aspernatur cum
        cupiditate deleniti ducimus esse eum ipsa nihil obcaecati placeat sed
        tenetur voluptatum! Ad asperiores atque autem deserunt eaque, eligendi
        enim exercitationem id ipsum, natus nemo neque numquam obcaecati, quae
        quis rerum tempora. Dolorem ea eaque laudantium maxime quibusdam.
        Aliquid consequatur cupiditate dolor ducimus eaque exercitationem fuga
        harum illo in ipsum labore laboriosam laborum magni maiores mollitia non
        nulla obcaecati perferendis, perspiciatis quaerat quas quia quis
        quisquam reprehenderit vel voluptas voluptatem! A ab adipisci alias
        aperiam autem commodi delectus dolorem dolores doloribus earum eius
        error eveniet hic illum itaque laboriosam, magni modi nostrum odio odit
        officiis pariatur placeat qui quia quo reprehenderit tempore voluptatem.
        A ad adipisci aperiam atque doloremque dolores doloribus ea eveniet
        expedita facilis fugit in modi nam natus nihil obcaecati officiis
        pariatur perspiciatis possimus quae quam quas, quibusdam quidem quisquam
        quos recusandae rem repellat sunt tempore totam ut veniam vitae
        voluptatum? Aliquid corporis dignissimos impedit labore maiores nulla
        quisquam quo soluta unde, voluptates. Adipisci amet, debitis dolorem
        doloribus exercitationem id in molestiae possimus quia quos reiciendis
        repellat sapiente suscipit tempore veritatis. A aliquam aspernatur cum
        deserunt dolores et eum ex fuga hic id illo illum, in molestias nihil
        non nulla odit quod rerum similique unde velit vero voluptatibus?
        Accusamus doloremque, dolores eius nihil tempore ut veritatis!
        Architecto assumenda at debitis deleniti, distinctio dolores ducimus
        eius explicabo fugit id illo illum in inventore iste magni natus nemo
        neque nisi officiis qui ullam velit voluptate, voluptatem. Eaque
        eligendi enim excepturi fugit iure laudantium, maxime officiis omnis
        possimus, provident quibusdam quidem sequi tempora! Culpa cum dicta
        fugiat ipsam, laboriosam nesciunt odit officiis omnis quam sequi?
        Aliquid blanditiis doloribus, eaque exercitationem facilis fugit ipsum,
        iste perferendis quasi ratione sint ut voluptates? Ad, alias cupiditate
        deleniti distinctio eaque eius eligendi esse expedita fuga impedit iste,
        labore modi mollitia necessitatibus neque nisi numquam omnis perferendis
        possimus, qui quisquam ratione saepe sapiente suscipit veritatis!
        Assumenda beatae eius, expedita harum illum libero maiores minus neque
        placeat reprehenderit sapiente, sed tenetur ut! Accusamus, ad alias
        aliquid amet animi aperiam asperiores autem commodi deleniti dignissimos
        dolores dolorum eum exercitationem explicabo facere fuga harum hic
        impedit inventore ipsam ipsum iure labore laboriosam nesciunt nostrum
        perspiciatis possimus quae quasi qui quis quod rem sed similique
        suscipit temporibus tenetur voluptatum. Alias earum, eligendi eveniet
        labore libero mollitia nostrum odit rerum soluta voluptate! Alias atque,
        autem blanditiis cum cumque delectus eligendi error illum laborum magnam
        minima necessitatibus nesciunt officia perspiciatis provident quae
        quidem, suscipit vel. Architecto aspernatur assumenda at, cupiditate,
        delectus distinctio dolore, eius exercitationem expedita impedit magni
        minus nulla optio praesentium qui quidem repellendus repudiandae soluta
        sunt voluptatem! Nulla optio sequi temporibus unde velit! Ab atque
        dignissimos dolores esse et inventore iste libero natus quod tempore,
        vero voluptates?
      </div>
    </div>
    <div class="container">
      <div
        v-if="mobile"
        id="burger"
        :class="{ open: burgerOpen }"
        @click="burgerOpen = !burgerOpen"
      >
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="logo">
        <nuxt-link to="/" no-prefetch><img src="/logo.svg" alt="" /></nuxt-link>
      </div>
      <div class="middle">
        <div v-if="mobile" class="burger">
          <span></span>
        </div>
        <nav v-if="!mobile" class="main-menu">
          <ul>
            <li>
              <nuxt-link to="/catalog">Catalog</nuxt-link>
            </li>
            <li><a href="#">About</a></li>
            <li><a href="#">How to buy</a></li>
            <li><a href="#">Contacts</a></li>
          </ul>
        </nav>
        <div class="search"></div>
      </div>
      <div class="control">
        <div class="profile">A</div>
        <div class="comparison">A</div>
        <div class="basked">A</div>
      </div>
    </div>
  </header>
</template>

<script>
export default {
  name: 'Header',
  data() {
    return {
      width: null,
      burgerOpen: false,
      swipeX: 0,
      startSwipe: 0,
    }
  },
  computed: {
    mobile() {
      console.log(this.width)
      return this.width < 568
    },
  },
  created() {
    if (process.client) {
      this.calcWith()
      window.addEventListener('resize', this.calcWith)
      window.addEventListener('touchstart', this.touchStart)
      window.addEventListener('touchend', this.touchEnd)
      window.addEventListener('touchmove', this.touchMove)
    }
  },
  beforeDestroy() {
    window.removeEventListener('resize', this.calcWith)
    window.removeEventListener('touchstart', this.touchStart)
    window.removeEventListener('touchstart', this.touchEnd)
    window.removeEventListener('touchstart', this.touchMove)
  },
  methods: {
    calcWith() {
      if (process.client) {
        this.width = window.innerWidth
      }
    },
    touchStart(e) {
      if (!this.mobile) return
      this.startSwipe = e.changedTouches[0].pageX
      if (
        this.burgerOpen &&
        e.changedTouches[0].target.classList.contains('mobile-menu__bg')
      ) {
        this.burgerOpen = !this.burgerOpen
      }
    },
    touchEnd(e) {
      if (!this.mobile) return
      this.$refs.menu.style.left = null
      if (!this.burgerOpen) {
        const swipe = e.changedTouches[0].pageX - this.startSwipe

        if (swipe > 100) {
          this.burgerOpen = !this.burgerOpen
        }
      }
    },
    touchMove(e) {
      if (!this.mobile) return
      const touch = e.changedTouches[0]
      this.swipeX = touch.pageX
      if (!this.burgerOpen) {
        const swipe = e.changedTouches[0].pageX - this.startSwipe
        if (swipe < 0) return
        this.$refs.menu.style.left = `-${100 - swipe}%`
      }
      console.log('test')
    },
  },
}
</script>

<style lang="scss">
header {
  display: flex;
  flex: 1 1 100%;
  align-items: center;
  justify-content: space-between;
  padding: 15px 0;

  box-shadow: #000e25 0 0 6px;

  background: rgb(29, 115, 115);
  background: linear-gradient(
    180deg,
    rgba(29, 115, 115, 1) 0%,
    rgba(0, 99, 99, 1) 67%,
    rgba(0, 153, 153, 1) 100%
  );

  .mobile-menu {
    @media all and (max-width: 567px) {
      position: fixed;
      width: 75%;
      height: 100vh;
      z-index: 100;
      background: wheat;
      left: -100%;
      top: 0;
      bottom: 0;
      transition: left 500ms ease;
      box-shadow: 10px 5px 30px, inset 0 0 10px;
      &.showMenu {
        display: flex;
        left: 0;
      }
      &__wrapper {
        padding: 5px;
        margin-top: 50px;

        overflow-y: auto;
      }
      &__bg {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
      }
    }
  }

  nav.main-menu {
    display: flex;

    ul {
      display: flex;

      li {
        margin: 0 5px;

        a {
          text-decoration: navajowhite;
          font-size: 20px;
          line-height: 24px;
          color: #ffb273;
          @media all and (max-width: 768px) {
            font-size: 16px;
            line-height: 18px;
          }

          &:hover {
            color: #ff7400;
          }
        }
      }
    }
  }

  .logo {
    max-width: 300px;
    flex: 1 1 20%;
    align-self: center;
  }

  .middle {
    flex: 1 1 100%;
  }

  .control {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    flex: 1 1;
  }

  #burger {
    min-width: 45px;
    height: 25px;
    position: relative;
    margin: auto 15px auto auto;
    z-index: 101;

    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
    -webkit-transition: 0.5s ease-in-out;
    -moz-transition: 0.5s ease-in-out;
    -o-transition: 0.5s ease-in-out;
    transition: 0.5s ease-in-out;
    cursor: pointer;
  }

  #burger span {
    display: block;
    position: absolute;
    height: 4px;
    width: 50%;
    background: #a66f00;
    opacity: 1;
    -webkit-transform: rotate(0deg);
    -moz-transform: rotate(0deg);
    -o-transform: rotate(0deg);
    transform: rotate(0deg);
    -webkit-transition: 0.25s ease-in-out;
    -moz-transition: 0.25s ease-in-out;
    -o-transition: 0.25s ease-in-out;
    transition: 0.25s ease-in-out;
  }

  #burger span:nth-child(even) {
    left: 50%;
    border-radius: 0 9px 9px 0;
  }

  #burger span:nth-child(odd) {
    left: 0;
    border-radius: 9px 0 0 9px;
  }

  #burger span:nth-child(1),
  #burger span:nth-child(2) {
    top: 0;
  }

  #burger span:nth-child(3),
  #burger span:nth-child(4) {
    top: 10px;
  }

  #burger span:nth-child(5),
  #burger span:nth-child(6) {
    top: 20px;
  }

  #burger.open span:nth-child(1),
  #burger.open span:nth-child(6) {
    -webkit-transform: rotate(45deg);
    -moz-transform: rotate(45deg);
    -o-transform: rotate(45deg);
    transform: rotate(45deg);
  }

  #burger.open span:nth-child(2),
  #burger.open span:nth-child(5) {
    -webkit-transform: rotate(-45deg);
    -moz-transform: rotate(-45deg);
    -o-transform: rotate(-45deg);
    transform: rotate(-45deg);
  }

  #burger.open span:nth-child(1) {
    left: 5px;
    top: 7px;
  }

  #burger.open span:nth-child(2) {
    left: calc(50% - 5px);
    top: 7px;
  }

  #burger.open span:nth-child(3) {
    left: -50%;
    opacity: 0;
  }

  #burger.open span:nth-child(4) {
    left: 100%;
    opacity: 0;
  }

  #burger.open span:nth-child(5) {
    left: 5px;
    top: 20px;
  }

  #burger.open span:nth-child(6) {
    left: calc(50% - 5px);
    top: 20px;
  }
}
</style>
